/*
 * Get the access list for a notify list
 *
 */
IF EXISTS
 (SELECT name FROM sysobjects WHERE name = 'getNotifyAccessList' AND type = 'P') 
 DROP PROC getNotifyAccessList
GO  
CREATE PROC getNotifyAccessList (
	@notifyID	userIdentifier
)
AS
BEGIN
  DECLARE @lastError int
  BEGIN TRAN
    SELECT notifyAccessList.userID, nickName, accountID, notifyAccessList.locked, maxMsgs, msgInterval, accessPriv
      FROM notifyAccessList, vpusers..users
      WHERE notifyID = @notifyID
      AND   notifyAccessList.userID = vpusers..users.userID
      AND   registrationMode = 2
      AND   accessPriv & 0x01 = 0x01
      ORDER BY nickName ASC

    SELECT @lastError = @@error
    IF @lastError != 0
    BEGIN
      ROLLBACK TRAN
      RETURN @lastError
    END
  COMMIT TRAN
END
GO

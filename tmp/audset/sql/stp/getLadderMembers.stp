/*
 * Get members of a game ladder
 *
 * Input: notifyID
 *
 * Output: 0 = success
 *         20000 = list not found
 *
 */
IF EXISTS
 (SELECT name FROM sysobjects WHERE name = 'getLadderMembers' AND type = 'P') 
 DROP PROC getLadderMembers
GO  
CREATE PROC getLadderMembers (
	@notifyID	userIdentifier
)
AS
BEGIN
  DECLARE @lastError	int

  IF EXISTS (SELECT * FROM ladderMembers WHERE notifyID = @notifyID)
  BEGIN
    SELECT m.userID, nickName, rank, joinedDate, won, lost, tied, streak,
     (SELECT rating FROM players p, ladders l WHERE p.userID = m.userID
AND p.gameTypeID = l.gameTypeID AND notifyID = @notifyID) AS rating
      FROM ladderMembers m, vpusers..users u
      WHERE notifyID = @notifyID
      AND m.userID = u.userID
      AND locked = 0
      AND pending = 0
      ORDER BY rank ASC, nickName ASC

    SELECT @lastError = @@error
    IF @lastError != 0
    BEGIN
      RETURN @lastError
    END
  END
  ELSE BEGIN
    RETURN 20000
  END
END
GO

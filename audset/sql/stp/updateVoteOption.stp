/* Updates an event vote option in the voteOptions table */
/* input:  voteId, vote option id, vote option, vote option description. 
   output: Errors:
            - 20001: Vote is active, cannot delete options
*/
CREATE PROC updateVoteOption
(
  @voteID		numeric(10,0),
  @voteOptionID		integer,
  @option		varchar(10),
  @description          varchar(50)
)
AS
BEGIN
  
  DECLARE @lastError    int
  DECLARE @status int

  /* Check that vote is not active */
  SELECT @status = status
    FROM eventVotes
    WHERE voteID = @voteID
  SELECT @lastError = @@error
  IF @lastError != 0
    RETURN @lastError

  IF @status = 1 
    RETURN 20001   /* Vote is active, cannot delete options */

  /* Update this option in the table */
  UPDATE voteOptions 
    SET label = @option, description = @description
    WHERE voteID = @voteID AND optionID = @voteOptionID
    
END
GO

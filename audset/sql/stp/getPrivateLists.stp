/*
 * Return a list of the private notify lists
 *
 * Input: showLocked = 1 => show all including locked
 *        showLocked = 0 => show unlocked only
 *        showUnlisted = 1 => show all including unlisted
 *        showUnlisted = 0 => show public only
 * The "locked" condition = service status | list locked
 *
 */
CREATE PROC getPrivateLists (
		@showLocked   bit = 0, 
		@showUnlisted bit = 0,
		@showCount    bit = 0)
AS
BEGIN
  IF @showLocked = 1
  BEGIN
    IF @showUnlisted = 1
    BEGIN
      -- locked = 1 AND unlisted = 1
      SELECT n.notifyID, n.type, s.bundleID, s.unitCost,
          description, subheader, URL, unlisted, approvalRqd,
          adultContent, nickName
        FROM notifyLists n, vpusers..userAccounts a, vpusers..users u,
             vpusers..services s, privateLists p
        WHERE s.type = 1
        AND   a.accountID = s.accountID
        AND   s.itemID = n.notifyID
        AND   s.itemID = p.notifyID
        AND   a.ownerID = u.userID
    END
    ELSE BEGIN
      -- locked = 1 AND unlisted = 0
      SELECT n.notifyID, n.type, s.bundleID, s.unitCost,
          description, subheader, URL, unlisted, approvalRqd,
          adultContent, nickName
        FROM notifyLists n, vpusers..userAccounts a, vpusers..users u,
             vpusers..services s, privateLists p
        WHERE s.type = 1
        AND   a.accountID = s.accountID
        AND   s.itemID = n.notifyID
        AND   s.itemID = p.notifyID
        AND   a.ownerID = u.userID
        AND   p.unlisted = 0
    END
  END
  ELSE BEGIN
    IF @showUnlisted = 1
    BEGIN
      -- locked = 0 AND unlisted = 1
      SELECT n.notifyID, n.type, s.bundleID, s.unitCost,
          description, subheader, URL, unlisted, approvalRqd,
          adultContent, nickName
        FROM notifyLists n, vpusers..userAccounts a, vpusers..users u,
             vpusers..services s, privateLists p
        WHERE s.type = 1
        AND   a.accountID = s.accountID
        AND   s.itemID = n.notifyID
        AND   s.itemID = p.notifyID
        AND   a.ownerID = u.userID
        AND   n.locked = 0
        AND   s.status = 0
    END
    ELSE BEGIN
      -- locked = 0 AND unlisted = 0
      SELECT n.notifyID, n.type, s.bundleID, s.unitCost,
          description, subheader, URL, unlisted, approvalRqd,
          adultContent, nickName
        FROM notifyLists n, vpusers..userAccounts a, vpusers..users u,
             vpusers..services s, privateLists p
        WHERE s.type = 1
        AND   a.accountID = s.accountID
        AND   s.itemID = n.notifyID
        AND   s.itemID = p.notifyID
        AND   a.ownerID = u.userID
        AND   p.unlisted = 0
        AND   n.locked = 0
        AND   s.status = 0
    END
  END
END
GO

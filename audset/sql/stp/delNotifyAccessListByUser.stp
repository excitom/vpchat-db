/*
 * Remove an access list entry for a notify list
 *
 * Sending messages to a notify list is restricted to users
 * on the access list.
 *
 * Input: List ID, userID
 *
 * Output: 0 = success
 *         20004 = user entry not found 
 */
CREATE PROC delNotifyAccessListByUser ( 
	@notifyID 	userIdentifier,
	@userID 	userIdentifier
)
AS
BEGIN
  DECLARE @lastError	int

  BEGIN TRAN
    IF EXISTS (SELECT * FROM notifyAccessList
                 WHERE notifyID = @notifyID AND userID = @userID)
    BEGIN
      DELETE notifyAccessList
        WHERE notifyID = @notifyID AND userID = @userID

      SELECT @lastError = @@error
      IF @lastError != 0
      BEGIN
        ROLLBACK TRAN
        RETURN @lastError
      END
    END
    ELSE BEGIN
      ROLLBACK TRAN
      RETURN 20004
    END

  COMMIT TRAN
END
GO

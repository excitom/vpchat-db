/* get the event states that have turned current 
   in the last X minutes */
/* input:  interval length in minutes - take this out when possible
   output: list of states, stating for each
           its event id and state id
*/
CREATE PROC getNewEventStates
AS
BEGIN
  DECLARE @lastError int

      SELECT eventState.eventID, eventState.stateID,
             welcomeMsg1, welcomeMsg2, PTGtitle
        FROM eventState, correctStates, events
        WHERE eventState.eventID = correctStates.eventID AND
              eventState.stateID = correctStates.stateID AND
	      events.eventID = eventState.eventID AND
	      events.currentState < eventState.stateID 
        ORDER BY eventID, time

    
    SELECT @lastError = @@error
    IF @lastError != 0
      RETURN @lastError
    
END
GO

/* get details for one event */
/* input:  event id
   output: event title, auditorium name, client name, date, 
           stage background, current state,
	   open time,  open welcome message 1, open welcome 2, open title,
	   start time,  start welcome message 1, start welcome 2, start title,
	   end time, interactions

           The output is returned in 3 result sets to simplify the SELECTs
*/
CREATE PROC getEvent ( @eventID eventIdentifier )
AS
BEGIN
  DECLARE @lastError int
  BEGIN TRAN
    
    SELECT stateID, time, welcomeMsg1, welcomeMsg2, PTGtitle
      FROM eventState
      WHERE eventID = @eventID
    
    SELECT @lastError = @@error
    IF @lastError != 0
    BEGIN
      ROLLBACK TRAN
      RETURN @lastError
    END
    
    SELECT name
      FROM interactionsAllowed
      WHERE eventID = @eventID
    
    SELECT @lastError = @@error
    IF @lastError != 0
    BEGIN
      ROLLBACK TRAN
      RETURN @lastError
    END
    
    SELECT events.title, auditoriums.name, events.client,
           date, stageBackground, currentState
      FROM events, auditoriums
      WHERE events.eventID = @eventID AND
            events.auditorium = auditoriums.auditoriumID
    
    SELECT @lastError = @@error
    IF @lastError != 0
    BEGIN
      ROLLBACK TRAN
      RETURN @lastError
    END
    
  COMMIT TRAN
END
GO



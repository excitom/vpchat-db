/*
 * Get email addresses of members of a game ladder
 *
 * Input: notifyID, accountID
 *
 * Output: 0 = success
 *         20000 = list not found
 *         20001 = list is locked
 *
 */
CREATE PROC getLadderEmails (
	@notifyID	userIdentifier,
	@accountID	userIdentifier
)
AS
BEGIN
  DECLARE @lastError	int
  DECLARE @locked	bit
  DECLARE @type		int

  SELECT @type = NULL
  SELECT @locked = locked, @type = type
	FROM ladders l, vpusers..services s
	WHERE notifyID = @notifyID
	AND s.itemID = l.notifyID
	AND s.accountID = @accountID

  SELECT @lastError = @@error
  IF @lastError != 0
  BEGIN
    RETURN @lastError
  END

  IF @type = NULL
  BEGIN
    RETURN 20000
  END

  IF @locked = 1
  BEGIN
    RETURN 20001
  END

  SELECT email
      FROM ladderMembers
      WHERE notifyID = @notifyID
      AND pending = 0

  SELECT @lastError = @@error
  IF @lastError != 0
  BEGIN
    RETURN @lastError
  END
END
GO

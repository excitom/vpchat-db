/*
 * Confirm that a player is a member of a game ladder
 *
 * Input: userID, notifyID
 *
 * Output: 0 = success
 *         20000 = no such ladder
 *
 *
 * Tom Lang 12/2004
 */
IF EXISTS
 (SELECT name FROM sysobjects WHERE name = 'checkLadderMember' AND type = 'P') 
 DROP PROC checkLadderMember
GO  
CREATE PROC checkLadderMember
(
  @userID	userIdentifier,
  @notifyID	userIdentifier
)
AS
BEGIN
  DECLARE @lastError int
  IF EXISTS
    (SELECT * FROM ladders WHERE notifyID = @notifyID)
  BEGIN
    SELECT m.userID, nickName, rank, joinedDate, won, lost, tied, streak,
     (SELECT rating FROM players p, ladders l WHERE p.userID = @userID
AND p.gameTypeID = l.gameTypeID AND notifyID = @notifyID) AS rating
      FROM ladderMembers m, vpusers..users u
      WHERE notifyID = @notifyID
      AND m.userID = @userID
      AND locked = 0
      AND pending = 0

    SELECT @lastError = @@error
    IF @lastError != 0
    BEGIN
      RETURN @lastError
    END
  END
  ELSE BEGIN
    RETURN 20000
  END
END
GO

/*
 * Change identify in access lists when an account owner changes
 *
 */
CREATE PROC changeNotifyListAccess (
	@accountID	userIdentifier,
	@userID		userIdentifier
)
AS
BEGIN
  DECLARE @lastError	int
  DECLARE @rows	int
  BEGIN TRAN
    SELECT @rows = COUNT(accountID) 
      FROM notifyAccessList
      WHERE accountID = @accountID

    SELECT @lastError = @@error
    IF @lastError != 0
    BEGIN
      ROLLBACK TRAN
      RETURN @lastError
    END

    IF @rows > 0
    BEGIN

      UPDATE notifyAccessList
        SET userID = @userID
        WHERE accountID = @accountID

      SELECT @lastError = @@error
      IF @lastError != 0
      BEGIN
        ROLLBACK TRAN
        RETURN @lastError
      END
    END
    SELECT @rows
  
  COMMIT TRAN
END
GO

/* add a shadow place entry */
CREATE PROC addShadowPlace ( @URL longName )
AS
BEGIN
  DECLARE @lastError int
  DECLARE @diffFromGMT int
  DECLARE @existingURL longName

  BEGIN TRAN
    /* try to find an existing
       shadow place using
       the same URL */
    SELECT @existingURL = URL
      FROM shadowPlaces
      WHERE URL = @URL 
   
    SELECT @lastError = @@error
    IF @lastError != 0
    BEGIN
      ROLLBACK TRAN
      RETURN @lastError
    END
  
    IF @existingURL IS NOT NULL
    BEGIN
      /* found an existing
         shadow place
         using the same URL */
      ROLLBACK TRAN
      RETURN 20001
    END
  
  INSERT shadowPlaces VALUES ( @URL )

  COMMIT TRAN

END
GO 

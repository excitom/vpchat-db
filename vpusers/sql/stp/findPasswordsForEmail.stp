/* find password for a given email
   INPUT  : email
   OUTPUT : list of passwords from the registration table
            for entries with this email
*/
CREATE PROC findPasswordsForEmail ( @email longName )
AS
BEGIN
  --  set isolation level to 0
  set transaction isolation level 0
  
  SELECT @email = lower(@email)
  SELECT password, registration.userID
    FROM registration,users ( INDEX registrationByEmailIdx )
    WHERE email = @email
    AND   locked = 0
    AND   users.userID = registration.userID
END
GO 

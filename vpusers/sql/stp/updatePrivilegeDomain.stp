/* update a privilege domain name for a specific user ID

   INPUT  : user ID, old domain name, new domain name
   OUTPUT : return value - 0 - successfull
                           -4 - trying to rename domain to a name that already exists
                                for this user
        
*/
CREATE PROC updatePrivilegeDomain
(
  @userID userIdentifier,
  @oldDomain UrlType,
  @newDomain UrlType
)
AS
BEGIN
  DECLARE @lastError int
  
  BEGIN TRAN delPrivilegeDomain
    UPDATE privilegeDomains
      SET domain = @newDomain
      WHERE ( userID = @userID ) AND
            ( domain = @oldDomain )
    
    SELECT @lastError = @@error
    IF @lastError != 0
    BEGIN
      ROLLBACK TRAN delPrivilegeDomain
      RETURN @lastError
    END
  COMMIT TRAN delPrivilegeDomain
END
GO

/* --- show all penalties (active and expired) for a user --- */
/* this is an interface for calling from an HTML GUI */
/* Customized for Halsoft by Tom Lang */
CREATE PROC showWarningsByName
( 
  @nickName VPuserID,
  @diffFromGMT int
)
AS
BEGIN
  DECLARE @lastError int
  DECLARE @now smalldatetime
  
  IF @diffFromGMT IS NULL
    SELECT @diffFromGMT = 0
    
  SELECT @lastError = @@error
  IF @lastError != 0
  BEGIN
    ROLLBACK TRAN
    RETURN @lastError
  END

  SELECT @now = dateadd( hour, (-1) * @diffFromGMT, getdate() )

  SELECT warningsWithNames.Name, 
	dateadd( hour, (@diffFromGMT), warnings.issuedOn) AS "Issued On", 
	warningsWithNames.issuer AS "Issued By",
	content
        FROM warningsWithNames,warnings
	WHERE warningsWithNames.Name = @nickName
	AND Id=warnings.warningID
    
  SELECT @lastError = @@error
  IF @lastError != 0
  BEGIN
    ROLLBACK TRAN
    RETURN @lastError
  END

  COMMIT TRAN
END
GO

/* remove a credit card or bank account to the bad credit list
   input:  ccID/edID
           accountID
	   type - 2=credit, 3=echeck

   output: Return value - 0 - success 
		 	  20001 - account not found

*/
CREATE PROC delBadCredit ( 
	@ccID		userIdentifier,
	@accountID	userIdentifier,
	@type		tinyint
)
AS
BEGIN
  DECLARE @lastError	int
  DECLARE @rc		int

  BEGIN TRAN
    
    IF EXISTS( SELECT * FROM badCredit WHERE ccID = @ccID AND type = @type )
    BEGIN
      DELETE FROM badCredit
        WHERE ccID = @ccID
        AND type = @type
   
      SELECT @lastError = @@error
      IF @lastError != 0
      BEGIN
        ROLLBACK TRAN
        RETURN @lastError
      END
    END
    ELSE BEGIN
      ROLLBACK TRAN
      RETURN 20001
    END
  COMMIT TRAN

  /*
   * add a history record
   */
  DECLARE @reason integer
  SELECT @reason = 34
  IF @type = 3
  BEGIN
    SELECT @reason = 35
  END
  EXEC addAcctHistory @accountID, @reason, @ccID

  RETURN 0
END
GO

/* get the privilege domains for specific nick name

   INPUT  : user ID
   OUTPUT : list of domain names
*/
CREATE PROC getPrivilegeDomainsByName ( @nickName VPuserID, @regMode VpRegMode = 2 )
AS
BEGIN
  DECLARE @lastError int
  
  BEGIN TRAN getPrivilegeDomainsByName
    SELECT domain
      FROM users, privilegeDomains
      WHERE ( nickName = @nickName ) AND
            ( registrationMode = @regMode ) AND
            ( privilegeDomains.userID = users.userID )
    
    SELECT @lastError = @@error
    IF @lastError != 0
    BEGIN
      ROLLBACK TRAN getPrivilegeDomainsByName
      RETURN @lastError
    END
  COMMIT TRAN getPrivilegeDomainsByName
END
GO

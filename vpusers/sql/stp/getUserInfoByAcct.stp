/* get information about users in an account
 Input: accountID

     return 0 - success
            20001 - account not found
*/
IF EXISTS
 (SELECT name FROM sysobjects WHERE name = 'getUserInfoByAcct' AND type = 'P') 
 DROP PROC getUserInfoByAcct
GO  
CREATE PROC getUserInfoByAcct ( @accountID userIdentifier )
AS
BEGIN
  DECLARE @lastError   int
  
  BEGIN TRAN 
    SELECT nickName,locked,restricted,penalties,warnings,ignores,password,lastSignOnDate,u.userID, points
      FROM users u, registration r, userPoints p
      WHERE r.accountID = @accountID
      AND   u.userID = r.userID
      AND   u.userID = p.userID
    UNION
    SELECT nickName,locked,restricted,penalties,warnings,ignores,password,lastSignOnDate,u.userID, 0 AS points
      FROM users u, registration r
      WHERE r.accountID = @accountID
      AND   u.userID = r.userID
      AND   u.userID NOT IN (SELECT userID FROM userPoints)
    ORDER BY nickName

    SELECT @lastError = @@error
    IF @lastError != 0
    BEGIN
      ROLLBACK TRAN 
      RETURN @lastError
    END

  COMMIT TRAN 
  RETURN 0
END
GO 
IF OBJECT_ID('dbo.getUserInfoByAcct') IS NOT NULL
        PRINT '<<< CREATED PROCEDURE dbo.getUserInfoByAcct >>>'
ELSE
        PRINT '<<< FAILED CREATING PROCEDURE dbo.getUserInfoByAcct >>>'
GO
